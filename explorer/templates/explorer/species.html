{% extends "explorer/variation.html" %}
{% load static from staticfiles %}
{% load explorer_extras %}

{% block filterjs %}
<script src='https://code.jquery.com/jquery-3.2.1.slim.min.js' integrity='sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN' crossorigin='anonymous'></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

<script>	
$(document).ready(function() {
	$('#id_clade_group_1').select2({width: "100%", allowClear: true, placeholder: "Select clade(s)"});
	$('#id_clade_group_2').select2({width: "100%", allowClear: true, placeholder: "Select clade(s)"});
	$('#id_clade_group_3').select2({width: "100%", allowClear: true, placeholder: "Select clade(s)"});
	$('#id_clade_group_4').select2({width: "100%", allowClear: true, placeholder: "Select clade(s)"});
	$('#id_clade_group_5').select2({width: "100%", allowClear: true, placeholder: "Select clade(s)"});
	$('#id_focus_1_0').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
	$('#id_focus_1_1').select2({width: "100%", allowClear: true, placeholder: "Select position"});
	$('#id_focus_2_0').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
	$('#id_focus_2_1').select2({width: "100%", allowClear: true, placeholder: "Select position"});
	$('#id_focus_3_0').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
	$('#id_focus_3_1').select2({width: "100%", allowClear: true, placeholder: "Select position"});
	$('#id_focus_4_0').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
	$('#id_focus_4_1').select2({width: "100%", allowClear: true, placeholder: "Select position"});
	$('#id_focus_5_0').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
	$('#id_focus_5_1').select2({width: "100%", allowClear: true, placeholder: "Select position"});
})
</script>
{% endblock %}


{% block plotjs %}
<script src='https://d3js.org/d3.v4.min.js'></script>
<script src="{% static 'explorer/js/distributions.js' %}"></script>
<script type = "text/javascript">

d3.json('{% url "explorer:species_distribution" clade_txids=clade_groups|clade_groups_to_url_string foci=foci|foci_to_url_string %}', draw_species_distribution);
</script>
{% endblock %}



{% block filter %}


{% if form.errors %}
<div class='alert alert-danger'>
	{% if form.non_field_errors %}
		{% for error in form.non_field_errors %}
			<li>Form error: {{ error|escape }}</li>
		{% endfor %}
	{% endif %}
	{% for field in form %}
		{% for error in field.errors %}
			<li>Error in field {{ field.name }}: {{ error|escape }}</li>
		{% endfor %}
	{% endfor %}
</div>
{% endif %}


<div class='p-3'>
	<div class='row vertical-align select-bar data-select-bar'>
		<div class='col-md-2 p-3'>
			<h4>Select tRNAs</h4>
		</div>
		<div class='col-md-10 p-3'>

			<form id='data-select-form' action='{% url "explorer:variation_species" %}' method="POST">
				{% csrf_token %}
				<div class='my-2'>
					{{ form.clade_group_1 }}
				</div>
				<div class='my-2'>
					{{ form.clade_group_2 }}
				</div>
				<div class='my-2'>
					{{ form.clade_group_3 }}
				</div>
				<div class='my-2'>
					{{ form.clade_group_4 }}
				</div>
				<div class='my-2'>
					{{ form.clade_group_5 }}
				</div>
				<div class='my-2'>
					<div class='row'>
						<div class='col'>
							{{ form.focus_1.as_widget.isotype }}
						</div>
						<div class='col'>
							{{ form.focus_1.as_widget.position }}
						</div>
					</div>
				</div>
				<div class='my-2'>
					<div class='row'>
						<div class='col'>
							{{ form.focus_2.as_widget.isotype }}
						</div>
						<div class='col'>
							{{ form.focus_2.as_widget.position }}
						</div>
					</div>
				</div>
				<div class='my-2'>
					<div class='row'>
						<div class='col'>
							{{ form.focus_3.as_widget.isotype }}
						</div>
						<div class='col'>
							{{ form.focus_3.as_widget.position }}
						</div>
					</div>
				</div>
				<div class='my-2'>
					<div class='row'>
						<div class='col'>
							{{ form.focus_4.as_widget.isotype }}
						</div>
						<div class='col'>
							{{ form.focus_4.as_widget.position }}
						</div>
					</div>
				</div>
				<div class='my-2'>
					<div class='row'>
						<div class='col'>
							{{ form.focus_5.as_widget.isotype }}
						</div>
						<div class='col'>
							{{ form.focus_5.as_widget.position }}
						</div>
					</div>
				</div>

				<div class='my-2'>
					<button class='btn btn-primary' type='submit'>Submit</button>
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}

{% block table %}
<table class="table">
	<tbody>
		<tr>
			<th scope="row">Clade groups</th>
			<td>{{ clade_group_names|clade_names_to_pretty_string|linebreaks }}</td>
		</tr>
		<tr>
			<th scope="row">Foci</th>
			<td>{{ foci|foci_to_pretty_string|linebreaks }}</td>
		</tr>
	</tbody>
</table>
{% endblock %}