{% extends "base.html" %}
{% load static from staticfiles %}
{% load explorer_extras %}
{% debug %}

{% block static %}
<link rel="stylesheet" href="{% static 'explorer/css/explorer.css' %}">
{% endblock %}

{% block title %}tRNAviz | Compare{% endblock %}

{% block filterjs %}
<script src='https://code.jquery.com/jquery-3.2.1.slim.min.js' integrity='sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN' crossorigin='anonymous'></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

<script>	
$(document).ready(function() {
	$('#reference-clade-select').select2({width: "100%", allowClear: true, placeholder: "Select reference clade"});
	$('#reference-isotype-select').select2({width: "100%", allowClear: true, placeholder: "Select reference isotype"});
	// $('#select-clade').select2({width: "100%", allowClear: true, placeholder: "Select clade"});
	// $('#select-isotype').select2({width: "100%", allowClear: true, placeholder: "Select isotype"});
})
</script>


<script type='text/javascript'>
function updateElementIndex(el, prefix, ndx) {
    var id_regex = new RegExp('(' + prefix + '-\\d+)');
    var replacement = prefix + '-' + ndx;
    if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
    if (el.id) el.id = el.id.replace(id_regex, replacement);
    if (el.name) el.name = el.name.replace(id_regex, replacement);
}
function cloneMore(selector, prefix) {
    var newElement = $(selector).clone(true);
    var total = $('#id_' + prefix + '-TOTAL_FORMS').val();
    newElement.find(':input').each(function() {
        var name = $(this).attr('name').replace('-' + (total-1) + '-', '-' + total + '-');
        var id = 'id_' + name;
        $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
    });
    total++;
    $('#id_' + prefix + '-TOTAL_FORMS').val(total);
    $(selector).after(newElement);
    var conditionRow = $('.form-row:not(:last)');
    conditionRow.find('.btn.add-form-row')
    .removeClass('btn-success').addClass('btn-danger')
    .removeClass('add-form-row').addClass('remove-form-row')
    .html('<span class="glyphicon glyphicon-minus" aria-hidden="true"></span>');
    return false;
}
function deleteForm(prefix, btn) {
    var total = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
    if (total > 1){
        btn.closest('.form-row').remove();
        var forms = $('.form-row');
        $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
        for (var i=0, formCount=forms.length; i<formCount; i++) {
            $(forms.get(i)).find(':input').each(function() {
                updateElementIndex(this, prefix, i);
            });
        }
    }
    return false;
}
$(document).on('click', '.add-form-row', function(e){
    e.preventDefault();
    cloneMore('.form-row:last', 'form');
    return false;
});
$(document).on('click', '.remove-form-row', function(e){
    e.preventDefault();
    deleteForm('form', $(this));
    return false;
});
</script>
{% endblock %}


{% block filter %}
<div class='p-3'>
	<form id='data-select-form' action='' method="POST">
		{% csrf_token %}
		<div class='row vertical-align select-bar data-select-bar'>
			<div class='col-md-2 p-3'>
				<h4>Select Reference</h4>
			</div>
			<div class='col-md-10 p-3'>

				<div class='input-group'>
					<div class='my-2'>
						<select class='multiselect' name="form_reference_clade" id="reference-clade-select">
							{% for clade in form.clade.field.choices %}
								{% if clade.1 == "Eukaryota (domain)" %}
								<option value="{{ clade.0 }}" selected="selected">{{ clade.1 }}</option>
								{% else %}
								<option value="{{ clade.0 }}">{{ clade.1 }}</option>
								{% endif %}
							{% endfor %}
						</select>
					</div>
					<div class='my-2'>
						<select class='multiselect' name="form_reference_isotype" id="reference-isotype-select">
							<option value="All" selected="selected">All isotypes</option>
							{% for isotype in form.isotype.field.choices %}
							<option value="{{ isotype }}">{{ isotype }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="input-group-append">
            <button class="btn btn-success add-form-row">+</button>
          </div>
				</div>
				<div class='my-2'>
					<button class='btn btn-primary' type='submit'>Submit</button>
				</div>
			</div>
		</div>
	</form>
</div>
{% endblock %}


{% block plots %}
<div class="p-3">

	<div class="p-3" id="bitchart-area">
			<img src="http://users.soe.ucsc.edu/~blin/pub/srna-viz/bitcharts/hg19-tRNA-Ser-AGA.png" width="100%" align="center">
		<!-- <div class="loading-overlay">
		</div> -->
	</div>
</div>
{% endblock %}